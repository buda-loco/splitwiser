---
phase: 10-ios-native-ux-layer
plan: 01
type: execute
depends_on: []
files_modified: [components/Sheet.tsx, components/BalanceDetail.tsx, components/SettlementHistory.tsx]
---

<objective>
Create reusable iOS-style sheet modal component with drag-to-dismiss gesture.

Purpose: Extract sheet pattern from BalanceDetail into a reusable component that all modals can use, providing consistent iOS-native feel across the app.
Output: Sheet component with drag gestures, refactored existing sheet usages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/BalanceDetail.tsx
@components/SettlementHistory.tsx
@tailwind.config.ts

**Tech stack available:** Framer Motion 12.33.0, Next.js 15, React 19, Tailwind CSS
**Established patterns:** Client components with 'use client', Framer Motion for animations, iOS color tokens (ios-blue, ios-gray, etc.), dark mode with dark: prefix
**Constraining decisions:**
- Phase 1: Framer Motion for animations, manual PageTransition wrapper pattern
- Beautiful UX as core value - gestures must feel fluid and responsive
- Offline-first architecture - sheet must work without network

**What exists:**
- BalanceDetail.tsx has a basic sheet modal with slide-up animation and backdrop
- SettlementHistory.tsx may have similar pattern
- Safe area padding utilities already configured (pb-safe-bottom, etc.)
- iOS design tokens configured in tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Sheet component with drag-to-dismiss</name>
  <files>components/Sheet.tsx</files>
  <action>
Create a reusable Sheet component following iOS modal patterns:

**Props interface:**
- isOpen: boolean
- onClose: () => void
- title?: string
- children: ReactNode

**Implementation requirements:**
- Use Framer Motion for animations (slide up from bottom, 300ms spring)
- Backdrop with 0.3 opacity black, tap to dismiss
- White sheet with rounded top corners (24px radius)
- Drag handle at top (gray pill, 36px wide, 5px tall, centered)
- Drag gesture to dismiss: drag down >100px OR velocity >500 triggers onClose
- Title section if provided (text-lg font-semibold, ios-blue color, 16px padding)
- Content area with scrollable overflow
- Safe area bottom padding (pb-safe-bottom)
- Dark mode support (dark:bg-gray-900 for sheet, dark:text-white for text)

**Drag gesture implementation:**
- Use Framer Motion's drag prop with dragConstraints
- dragElastic={0.2} for natural resistance
- onDragEnd checks drag.offset.y and drag.velocity.y
- Animate sheet back to y=0 if not dismissed, or y=1000 if dismissed

**Avoid:**
- Do NOT use external dialog libraries (Radix, HeadlessUI) - custom implementation only
- Do NOT make sheet full-height - keep it bottom-aligned with natural height based on content
- Do NOT use transform-based animations for initial mount (causes layout shift) - use Framer Motion variants
</action>
  <verify>TypeScript compiles without errors, Sheet component exports correct interface</verify>
  <done>Sheet component exists with drag gesture, backdrop, title, and content area. Dark mode colors applied.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor BalanceDetail to use Sheet component</name>
  <files>components/BalanceDetail.tsx</files>
  <action>
Replace the custom modal implementation in BalanceDetail with the new Sheet component:

**Changes:**
- Import Sheet component
- Remove custom backdrop and container divs
- Remove custom motion.div animations
- Wrap content in &lt;Sheet isOpen={isOpen} onClose={onClose} title="Balance Details"&gt;
- Keep the expense list content as children
- Remove any manual safe area padding (Sheet handles it)
- Preserve tap navigation to expense detail

**Keep:**
- Loading state handling
- Empty state for simplified view
- Expense list rendering with formatDate, formatCurrency
- Dark mode text colors for expense items

**Result:**
BalanceDetail should be significantly simpler, just wrapping content in Sheet.
</action>
  <verify>BalanceDetail still renders correctly, sheet opens/closes, drag-to-dismiss works, tap to expense detail still functions</verify>
  <done>BalanceDetail uses Sheet component, functionality preserved, code is cleaner.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] Sheet component is exported and properly typed
- [ ] BalanceDetail uses Sheet component and renders correctly
- [ ] Drag gesture dismisses sheet smoothly
- [ ] Backdrop tap dismisses sheet
- [ ] Dark mode colors work correctly
</verification>

<success_criteria>
- Sheet component created with full drag-to-dismiss functionality
- BalanceDetail refactored to use Sheet
- All TypeScript types correct
- No build errors or warnings
- Reusable component ready for other modals
</success_criteria>

<output>
After completion, create `.planning/phases/10-ios-native-ux-layer/10-01-SUMMARY.md`:

# Phase 10 Plan 1: Sheet Modal Component Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `components/Sheet.tsx` - Description
- `components/BalanceDetail.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 10-02, 10-03, 10-04, 10-05 (can run in parallel - independent components)
</output>
