---
phase: 10-ios-native-ux-layer
plan: 02
type: execute
depends_on: []
files_modified: [components/SwipeNavigation.tsx, app/layout.tsx, components/PageTransition.tsx]
---

<objective>
Implement swipe-back gesture navigation for iOS-native feel.

Purpose: Add intuitive swipe-from-left-edge gesture to navigate back, matching iOS native app behavior and making navigation feel more natural.
Output: Swipe gesture system integrated with Next.js router, enhanced PageTransition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/PageTransition.tsx
@app/layout.tsx

**Tech stack available:** Framer Motion 12.33.0, Next.js 15 App Router, React 19
**Established patterns:** PageTransition wrapper with Framer Motion, client components
**Constraining decisions:**
- Phase 1: Manual PageTransition wrapper (not Template pattern)
- Beautiful UX as core value - swipe must feel fluid and responsive like native iOS

**What exists:**
- PageTransition component with basic slide animations (x: 20 → 0 → -20)
- App Router navigation via next/navigation (useRouter, usePathname)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SwipeNavigation component with back gesture</name>
  <files>components/SwipeNavigation.tsx</files>
  <action>
Create SwipeNavigation component that wraps content and handles swipe-from-left gesture:

**Implementation:**
- Client component with 'use client'
- Use Framer Motion's motion.div with drag="x"
- dragConstraints={{ left: 0, right: 300 }} (only allow right drag, not left)
- dragElastic={{ left: 0, right: 0.3 }} (resistance on right drag)
- Track drag with onDrag callback, extract info.offset.x
- Show previous page preview on left (gradient overlay suggesting back)
- onDragEnd: if offset.x > 100 OR velocity.x > 500, call router.back()
- If not dismissed, spring back to x: 0

**Router integration:**
- useRouter() from 'next/navigation' for router.back()
- usePathname() to detect if we're on root page (disable swipe if pathname === '/')
- Disable swipe on root routes where there's no history

**Visual feedback:**
- As user drags right, show gradient overlay from left edge (simulates previous page)
- Gradient: linear-gradient(to right, rgba(0,0,0,0.1), transparent)
- Page content follows finger with slight resistance (dragElastic)

**Avoid:**
- Do NOT prevent horizontal scrolling within content (only edge gesture)
- Do NOT interfere with other touch interactions (buttons, inputs)
- Do NOT use manual history tracking (rely on Next.js router state)
- Do NOT conflict with drag interactions in Sheet component (different drag axis)
</action>
  <verify>TypeScript compiles, SwipeNavigation component exports, drag gesture works on test page</verify>
  <done>SwipeNavigation component with working back gesture, respects root page constraint.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance PageTransition for swipe animations</name>
  <files>components/PageTransition.tsx</files>
  <action>
Update PageTransition to support swipe-triggered navigation animations:

**Current state:**
- Simple slide animation (opacity + x translate)
- Fixed direction (left/right based on enter/exit)

**Enhancements:**
- Keep existing animation (don't break current behavior)
- Add support for detecting swipe navigation direction
- Use AnimatePresence mode="wait" (already present)
- Increase exit animation speed slightly for swipe feel (damping: 15 instead of 20)
- Ensure initial/animate/exit animations feel connected to swipe gesture

**Keep simple:**
- Don't overcomplicate - PageTransition should remain a thin wrapper
- Don't try to sync with SwipeNavigation drag offset (animation after navigation)
- Keep current props interface (just children)

**Goal:**
Slightly snappier exit animation that complements the swipe gesture feel.
</action>
  <verify>PageTransition still works on all existing pages, animations feel smoother</verify>
  <done>PageTransition enhanced with quicker exit animation, compatible with swipe navigation.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Swipe-back gesture navigation system</what-built>
  <how-to-verify>
1. Run: npm run dev
2. Navigate to /expenses page
3. Swipe from left edge toward right (touch or trackpad gesture)
4. Verify: Page content follows finger with resistance
5. Verify: Gradient appears from left edge as you drag
6. Swipe >100px right: Verify navigation back to home
7. Try on home page (/): Verify swipe is disabled (no previous page)
8. Test rapid swipe (high velocity): Verify it triggers navigation
9. Test short swipe (<100px): Verify page springs back, no navigation
10. Check dark mode: Verify gradient overlay looks correct
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] SwipeNavigation component exists and exports correctly
- [ ] Swipe gesture works on detail pages
- [ ] Swipe disabled on root page
- [ ] PageTransition animations feel connected
- [ ] No interference with other touch interactions
</verification>

<success_criteria>
- SwipeNavigation component with working back gesture
- PageTransition enhanced for swipe feel
- User verification confirms natural iOS-like navigation
- No TypeScript errors
- Works in light and dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/10-ios-native-ux-layer/10-02-SUMMARY.md`:

# Phase 10 Plan 2: Swipe Navigation Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `components/SwipeNavigation.tsx` - Description
- `components/PageTransition.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for parallel execution with 10-03, 10-04, 10-05 (independent features)
</output>
