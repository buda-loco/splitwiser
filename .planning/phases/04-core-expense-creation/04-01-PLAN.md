---
phase: 04-core-expense-creation
plan: 01
type: execute
depends_on: []
files_modified: [components/ExpenseForm.tsx, app/expenses/new/page.tsx]
---

<objective>
Create expense form with basic fields and form validation for creating new expenses.

Purpose: Enable users to input expense data (amount, description, date, category) with iOS-native form UX that feels natural and immediate.
Output: Working expense creation form integrated with optimistic updates for instant feedback.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-data-model-and-offline-foundation/03-03-SUMMARY.md
@.planning/phases/03-data-model-and-offline-foundation/03-06-SUMMARY.md
@lib/offline/optimistic.ts
@hooks/useOptimisticMutation.ts
@lib/db/types.ts
@components/BottomNav.tsx

**Tech stack available:**
- React 19 with hooks
- Next.js 15 with App Router
- Tailwind CSS with iOS design tokens
- Framer Motion for animations
- OptimisticUpdateManager for instant UI updates
- useOptimisticMutation hook for form integration

**Established patterns:**
- 'use client' directive for client components
- Bottom navigation with page transitions
- iOS-native design (San Francisco font, native controls)
- Optimistic updates with rollback capability

**Constraining decisions:**
- Phase 3: Optimistic updates happen immediately in IndexedDB before sync
- Phase 1: iOS-native UX as core value
- PROJECT: Beautiful UX that makes expense splitting feel effortless
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ExpenseForm component with form state and validation</name>
  <files>components/ExpenseForm.tsx</files>
  <action>Create ExpenseForm component with controlled form inputs for:

**Fields:**
- amount: number input with decimal support (e.g., "12.50")
- currency: select dropdown (default AUD, also EUR, USD, GBP)
- description: text input (required)
- category: select dropdown (predefined categories: Food, Transport, Accommodation, Activities, Other)
- expense_date: date input (defaults to today)
- paid_by: hidden for now (will be current user, added in Task 2)

**iOS-native styling:**
- Use Tailwind iOS design tokens from Phase 1
- Input fields with rounded corners, proper padding
- Label above each field (San Francisco font)
- Currency symbol prefix on amount input
- Date picker with iOS-native appearance
- Category dropdown with iOS select styling

**Form validation:**
- amount: required, must be > 0, max 2 decimal places
- description: required, min 1 character, max 255 characters
- category: required
- expense_date: required, cannot be future date
- Show validation errors below each field when touched

**State management:**
- useState for form fields
- Track which fields have been touched for validation display
- Disable submit button when form invalid
- Clear form after successful submission

**Component structure:**
```tsx
'use client';

export function ExpenseForm({
  onSubmit,
  onCancel
}: {
  onSubmit: (expense: ExpenseFormData) => void;
  onCancel?: () => void;
}) {
  // Form state, validation, handlers
  return (
    <form className="...iOS-native styling...">
      {/* Amount field */}
      {/* Currency field */}
      {/* Description field */}
      {/* Category field */}
      {/* Date field */}
      {/* Submit button */}
    </form>
  );
}
```

**Avoid:**
- DO NOT use HTML5 required attribute (use custom validation for better UX)
- DO NOT submit without validation (show errors inline)
- DO NOT use Material-UI or other non-iOS patterns
- DO NOT make API calls here (optimistic update happens in page component)</action>
  <verify>TypeScript compiles, component renders with all fields, validation shows appropriate errors when fields touched</verify>
  <done>ExpenseForm component created with amount/currency/description/category/date fields, iOS-native styling, inline validation, disabled submit when invalid</done>
</task>

<task type="auto">
  <name>Task 2: Create new expense page with optimistic submission</name>
  <files>app/expenses/new/page.tsx</files>
  <action>Create page component that integrates ExpenseForm with optimistic updates:

**Page structure:**
```tsx
'use client';

import { ExpenseForm } from '@/components/ExpenseForm';
import { useOptimisticMutation } from '@/hooks/useOptimisticMutation';
import { useRouter } from 'next/navigation';

export default function NewExpensePage() {
  const { createExpense, isLoading, error } = useOptimisticMutation();
  const router = useRouter();

  const handleSubmit = async (formData) => {
    try {
      // Get current user from auth (placeholder for now - will integrate with auth later)
      const currentUserId = 'temp-user-id'; // TODO: Replace with actual auth

      const expense = {
        ...formData,
        paid_by_user_id: currentUserId,
        created_by_user_id: currentUserId,
        // Participants and splits will be added in later plans
      };

      const id = await createExpense(expense);

      // Show success toast (use Framer Motion)
      // Navigate to expense detail or back to list
      router.push(`/expenses/${id}`);
    } catch (err) {
      // Error displayed via useOptimisticMutation error state
      console.error('Failed to create expense:', err);
    }
  };

  return (
    <div className="max-w-md mx-auto px-4 py-6 pb-safe">
      <h1 className="text-2xl font-semibold mb-6">New Expense</h1>

      <ExpenseForm
        onSubmit={handleSubmit}
        onCancel={() => router.back()}
      />

      {error && (
        <div className="mt-4 p-3 bg-red-50 text-red-700 rounded-lg">
          {error.message}
        </div>
      )}
    </div>
  );
}
```

**Features:**
- Integrates useOptimisticMutation hook from Phase 3
- Handles form submission with optimistic update
- Shows loading state during submission (though optimistic = instant)
- Displays error if optimistic update fails
- Navigates to expense detail after creation
- Uses pb-safe for notch support

**Avoid:**
- DO NOT wait for sync before navigating (optimistic = immediate)
- DO NOT show loading spinner (expense appears instantly)
- DO NOT make direct Supabase calls (use optimistic manager)
- DO NOT forget 'use client' directive (hooks require client component)</action>
  <verify>TypeScript compiles, page renders form, submit creates expense in IndexedDB, navigates to detail page, error handling works</verify>
  <done>New expense page created with ExpenseForm integration, optimistic submission via useOptimisticMutation, navigation after creation, error display</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors (npx tsc --noEmit)
- [ ] ExpenseForm component renders with all fields
- [ ] Form validation prevents invalid submissions
- [ ] New expense page creates expense in IndexedDB optimistically
- [ ] Navigation works after successful creation
- [ ] Error states display appropriately
</verification>

<success_criteria>
- ExpenseForm component complete with 5 fields and validation
- New expense page integrated with optimistic updates
- Form has iOS-native styling matching Phase 1 patterns
- Validation prevents invalid submissions
- Optimistic creation works (expense appears instantly)
- No TypeScript errors
- Ready for participant picker (Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/04-core-expense-creation/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Expense Form and Creation Summary

**Basic expense creation with optimistic updates**

## Accomplishments

- Created ExpenseForm component with amount, currency, description, category, date fields
- Implemented inline form validation with error display
- Built iOS-native form styling with proper iOS controls
- Created new expense page integrating with optimistic updates
- Enabled instant expense creation without loading states
- Added navigation to detail page after creation

## Files Created/Modified

- `components/ExpenseForm.tsx` - Form component with validation
- `app/expenses/new/page.tsx` - New expense page with optimistic submission

## Decisions Made

[Document any form validation rules, styling choices, or navigation patterns]

## Issues Encountered

[Any issues with form state management, validation, or "None"]

## Next Step

Ready for 04-02-PLAN.md (Participant picker with smart suggestions)
</output>
