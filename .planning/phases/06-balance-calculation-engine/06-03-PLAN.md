---
phase: 06-balance-calculation-engine
plan: 03
type: execute
depends_on: ["06-02"]
files_modified: [components/BalanceView.tsx, app/balances/page.tsx]
---

<objective>
Create balance summary screen showing who owes whom with toggle between simplified and direct views.

Purpose: Primary UI for users to see all outstanding balances. Must clearly show who owes what to whom.
Output: Balance summary page with iOS-native styling and simplification toggle.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work in this phase
@.planning/phases/06-balance-calculation-engine/06-01-SUMMARY.md
@.planning/phases/06-balance-calculation-engine/06-02-SUMMARY.md

# Key files
@lib/balances/types.ts
@hooks/useBalances.ts
@components/ExpenseList.tsx

**Tech stack available:** Next.js 15, TypeScript, Tailwind, Framer Motion
**Established patterns:**
- iOS-native styling with rounded-2xl cards, proper shadows, dark mode support
- Sticky headers with back buttons
- Loading states with centered messages
- Toggle switches for filtering options (from ExpenseList)

**iOS design tokens:**
- ios-blue, ios-gray-light, ios-gray, ios-red
- Safe area padding for notched devices
- -apple-system font stack
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BalanceView component</name>
  <files>components/BalanceView.tsx</files>
  <action>
Create balance display component showing all debts:

Structure:
1. Toggle switch at top: "Simplified" vs "Direct" (use iOS-style toggle)
2. Balance entries list:
   - Each entry shows: "{from.name} owes {to.name} {currency}{amount}"
   - Green for amounts you're owed
   - Red for amounts you owe
   - Gray for amounts between others (not involving current user)
3. Total summary at bottom (optional): "Total you owe: X" / "Total owed to you: Y"

Styling:
- iOS-native card layout (bg-white dark:bg-gray-800, rounded-2xl, shadow)
- Each balance entry: iOS list row with padding, border-bottom
- Amount display: Bold, right-aligned
- Toggle: iOS-style with smooth transition (Framer Motion)

Use useBalances hook for data and simplified state.

Loading state: Centered "Calculating balances..." message.

Empty state: "No outstanding balances" with checkmark icon.

Current user detection: Use Supabase auth to identify current user, highlight entries involving them.
  </action>
  <verify>Component compiles. Renders balance list. Toggle switches between simplified and direct views.</verify>
  <done>BalanceView component displays all balances with toggle, iOS-native styling, loading/empty states, and current user highlighting.</done>
</task>

<task type="auto">
  <name>Task 2: Create balance summary page</name>
  <files>app/balances/page.tsx</files>
  <action>
Create /balances route:

```typescript
export default function BalancesPage() {
  return (
    <div className="min-h-screen bg-ios-gray-light dark:bg-black pb-safe">
      {/* Sticky header */}
      <div className="sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
        <div className="px-4 py-3 flex items-center gap-3">
          <button onClick={() => router.back()} className="...">
            ← Back
          </button>
          <h1 className="text-lg font-semibold">Balances</h1>
        </div>
      </div>

      {/* Balance view */}
      <div className="p-4">
        <BalanceView />
      </div>
    </div>
  );
}
```

Pattern: Follow expense list page structure (from 04-07-SUMMARY.md). Sticky header, content area, safe area padding.

Navigation: Back button uses router.back() for natural flow.
  </action>
  <verify>Page renders at /balances route. Header sticky, balance view displays correctly.</verify>
  <done>Balance summary page accessible at /balances with sticky header and BalanceView integration.</done>
</task>

<task type="auto">
  <name>Task 3: Add balance navigation to app</name>
  <files>app/page.tsx</files>
  <action>
Add "View Balances" button to home page:

Location: Below expense list, above "Add Expense" button.

Button styling:
- Secondary button style (outlined, not filled)
- Full width like "Add Expense"
- Icon: Scale/balance icon (⚖️ or custom SVG)
- Text: "View Balances"

On click: Navigate to /balances using next/navigation router.

Pattern: Similar to existing navigation buttons on home page.

Why on home page: Balances are primary feature, should be easily accessible from main screen.
  </action>
  <verify>Button appears on home page. Clicking navigates to /balances.</verify>
  <done>"View Balances" button on home page navigates to balance summary screen.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors (npx tsc --noEmit)
- [ ] BalanceView component displays all balances
- [ ] Toggle between simplified and direct works
- [ ] Balance entries styled with iOS-native patterns
- [ ] Current user balances highlighted (green/red)
- [ ] Loading and empty states work
- [ ] /balances page accessible and functional
- [ ] Home page has "View Balances" button
- [ ] Dark mode works throughout
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Balance summary screen fully functional
- Toggle between simplified and direct balances works
- iOS-native styling throughout
- Navigation integrated into app
</success_criteria>

<output>
After completion, create `.planning/phases/06-balance-calculation-engine/06-03-SUMMARY.md`
</output>
