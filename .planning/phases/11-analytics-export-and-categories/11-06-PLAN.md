---
phase: 11-analytics-export-and-categories
plan: 06
type: execute
depends_on: []
files_modified: [components/GlobalSearch.tsx, app/search/page.tsx, lib/utils/search.ts]
---

<objective>
Implement global search functionality across all expenses with filtering and result highlighting.

Purpose: Enable users to quickly find specific expenses by description, participant, tag, category, or amount.
Output: Global search component with debounced input, search results page, and multi-field search logic.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/db/stores.ts
@components/ExpenseList.tsx

**Tech stack available:** IndexedDB for expense queries, use-debounce for debounced search input
**Established patterns:** iOS search bar styling, ExpenseList component for results display
**Current state:** No search functionality exists, ExpenseList only shows all/filtered by time
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build GlobalSearch component</name>
  <files>components/GlobalSearch.tsx</files>
  <action>Create GlobalSearch component with debounced search input (500ms delay). Props: onSearch (callback with search query), placeholder. Use iOS-native search bar styling: rounded background (ios-surface), search icon (Lucide Search) on left, clear button (X icon) on right when input has value. Install use-debounce library if not present: npm install use-debounce. Implement debounced onChange that calls onSearch after 500ms. Include search filters below input: "Amount Range" (min/max), "Date Range" (date picker), "Category" (dropdown). Filters appear when search query exists. Use Framer Motion for filter panel slide-in animation. Match iOS styling with proper safe areas and dark mode.</action>
  <verify>GlobalSearch renders search input, typing triggers debounced onSearch, clear button works, filters display on search, TypeScript compiles</verify>
  <done>GlobalSearch component with debounced input, filters, and iOS-native styling</done>
</task>

<task type="auto">
  <name>Task 2: Create search utility functions</name>
  <files>lib/utils/search.ts</files>
  <action>Create searchExpenses(query, expenses, filters?) function that searches across: description (case-insensitive substring match), participant names (lookup via getParticipantById or display name), tags (array includes), category (exact match), amount (if query is number, match Â±10%). Rank results by relevance: exact description match > description contains > tag match > participant match > category match. Apply optional filters: amountRange {min, max}, dateRange {start, end}, categoryId. Return SearchResult[] with: expense, matchedFields (array of field names that matched), highlightText (text to highlight in UI). Sort by relevance score descending, then by date descending.</action>
  <verify>searchExpenses returns matching expenses, ranks by relevance, applies filters correctly, handles empty query gracefully</verify>
  <done>Search utility functions with multi-field search and relevance ranking</done>
</task>

<task type="auto">
  <name>Task 3: Create search results page</name>
  <files>app/search/page.tsx</files>
  <action>Create /search route page with GlobalSearch component at top and search results below. Load all expenses from getExpenses() on mount. When user searches, call searchExpenses() and display results using ExpenseList-like component (reuse or create SearchResultsList). Each result shows expense details + subtle badge showing matched field ("Found in: Description" or "Tag: #bali-trip"). Highlight matched text in description using <mark> tag with ios-blue background. Show "No results" state with search tips ("Try searching by amount, description, or tag"). Add link to search from main nav or settings. Use iOS-native layout with safe areas and dark mode.</action>
  <verify>/search page loads, GlobalSearch component renders, typing triggers search, results display with matched field badges, highlighting works, no results state shows</verify>
  <done>Search results page with GlobalSearch, results display, and highlighting</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GlobalSearch component renders with debounced input
- [ ] Search filters display and work correctly
- [ ] searchExpenses() returns relevant results ranked correctly
- [ ] /search page displays results with matched field indicators
- [ ] Text highlighting works in search results
- [ ] "No results" state displays appropriately
- [ ] Dark mode works for search UI
</verification>

<success_criteria>

- All tasks completed
- Global search functional across all fields
- Results ranked by relevance
- Filters work correctly
- iOS-native UX maintained
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-export-and-categories/11-06-SUMMARY.md`
</output>
