---
phase: 11-analytics-export-and-categories
plan: 03
type: execute
depends_on: []
files_modified: [app/analytics/page.tsx, components/DateRangeSelector.tsx, lib/utils/analytics.ts]
---

<objective>
Create analytics page foundation with date range filtering and data aggregation functions.

Purpose: Establish the structure for spending insights and prepare data processing utilities for charts.
Output: Analytics page with date range selector, aggregation functions for filtered expense data.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/db/stores.ts
@components/ExpenseList.tsx

**Tech stack available:** Next.js App Router, Framer Motion, date-fns for date manipulation
**Established patterns:** Filter tabs (similar to ExpenseList time filters), iOS-native styling
**Current state:** No analytics page exists, expense data available via getExpenses()
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create analytics page structure</name>
  <files>app/analytics/page.tsx</files>
  <action>Create /analytics route page with header ("Analytics"), description ("Insights into your spending patterns"), and placeholder sections for charts (to be added in 11-04). Add navigation to analytics from BottomNav (currently has 4 tabs: Expenses, Balances, Settlements, Settings - keep Settings, replace or add Analytics as 4th/5th tab, use BarChart3 icon from Lucide). Use standard page layout with safe areas, proper spacing, and dark mode support.</action>
  <verify>Page loads at /analytics, header displays, placeholder sections visible, navigation from BottomNav works, dark mode works</verify>
  <done>Analytics page exists at /analytics, accessible from bottom navigation</done>
</task>

<task type="auto">
  <name>Task 2: Build DateRangeSelector component</name>
  <files>components/DateRangeSelector.tsx</files>
  <action>Create DateRangeSelector with preset options: "This Week", "This Month", "Last 3 Months", "This Year", "All Time", "Custom". Display as horizontal scrollable tabs (similar to ExpenseList time filters). Custom option opens iOS-native date picker sheet modal for start/end date selection. Props: value (DateRange object: {start: Date, end: Date, preset: string}), onChange. Use Framer Motion for tab animations. Export getDateRangePreset() helper that converts preset string to start/end dates. Match iOS styling with rounded pills and blue selection indicator.</action>
  <verify>DateRangeSelector displays 6 preset options, selecting preset calls onChange with date range, custom picker works, animations smooth</verify>
  <done>DateRangeSelector component with presets and custom range picker, iOS-native UX</done>
</task>

<task type="auto">
  <name>Task 3: Create data aggregation utilities</name>
  <files>lib/utils/analytics.ts</files>
  <action>Create analytics utility functions: 1) filterExpensesByDateRange(expenses, dateRange) - returns expenses within range, 2) aggregateByCategory(expenses) - returns {categoryId: {total, count, expenses[]}}, 3) aggregateByPerson(expenses, userId) - returns {personId: {totalPaid, totalOwed, netBalance}}, 4) calculateTotalSpent(expenses) - sum of all expense amounts with multi-currency conversion, 5) getMostExpensiveCategory(aggregated) - returns category with highest total. Use existing getExpenses() and expense types. Handle multi-currency by converting to user's preferred currency (from user profile). Return results sorted by total descending.</action>
  <verify>Functions exist, filterExpensesByDateRange filters correctly, aggregateByCategory groups by category, calculateTotalSpent sums amounts, TypeScript types correct</verify>
  <done>Analytics utility functions for data aggregation and filtering</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] /analytics page loads with header and description
- [ ] DateRangeSelector displays all preset options
- [ ] Selecting date range updates state
- [ ] Analytics utility functions compile and export correctly
- [ ] Dark mode works for analytics page
- [ ] Navigation from BottomNav to analytics works
</verification>

<success_criteria>

- All tasks completed
- Analytics page foundation established
- Date range filtering functional
- Data aggregation utilities ready for charts
- iOS-native UX maintained
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-export-and-categories/11-03-SUMMARY.md`
</output>
