---
phase: 11-analytics-export-and-categories
plan: 04
type: execute
depends_on: ["11-03"]
files_modified: [package.json, components/SpendingByCategory.tsx, components/SpendingByPerson.tsx, lib/utils/analytics.ts]
---

<objective>
Build interactive spending charts (category and per-person breakdowns) using Recharts library.

Purpose: Visualize spending patterns to help users understand where money goes and who spends the most.
Output: Two chart components (category breakdown, person breakdown) with pie/bar toggle and responsive design.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-analytics-export-and-categories/11-03-SUMMARY.md
@lib/utils/analytics.ts

**Tech stack available:** Next.js 15, TypeScript, Tailwind, Framer Motion
**From 11-03:** DateRangeSelector, aggregateByCategory(), aggregateByPerson() utilities
**Decision:** Use Recharts library (React-native, Next.js compatible, good TypeScript support, MIT license)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure Recharts</name>
  <files>package.json</files>
  <action>Install recharts library: npm install recharts. Verify version is compatible with Next.js 15 and React 18. Create recharts.config.ts if needed for custom theme matching iOS colors (ios-blue, ios-green, ios-red, etc. from Tailwind). Test that Recharts renders in Next.js client components (use 'use client' directive).</action>
  <verify>npm install succeeds, recharts appears in package.json dependencies, TypeScript recognizes recharts types</verify>
  <done>Recharts library installed and configured for Next.js</done>
</task>

<task type="auto">
  <name>Task 2: Build SpendingByCategory chart</name>
  <files>components/SpendingByCategory.tsx</files>
  <action>Create SpendingByCategory component with toggle between PieChart and BarChart views. Accept props: expenses (array), dateRange. Use aggregateByCategory() to process data. PieChart: segments colored by category colors, labels show category name + percentage, center shows total amount. BarChart: horizontal bars sorted by amount descending, X-axis shows amount in user's currency, Y-axis shows category names. Add toggle button (PieChart/BarChart icons from Lucide) in top-right. Use Recharts ResponsiveContainer for mobile responsiveness. Style with iOS colors and dark mode support. Show "No data" state if no expenses in range. Use Framer Motion for chart type transition (AnimatePresence).</action>
  <verify>SpendingByCategory renders pie chart by default, toggle switches to bar chart, data aggregates correctly by category, responsive on mobile, dark mode works</verify>
  <done>SpendingByCategory component with pie/bar toggle, responsive, iOS-styled</done>
</task>

<task type="auto">
  <name>Task 3: Build SpendingByPerson chart</name>
  <files>components/SpendingByPerson.tsx</files>
  <action>Create SpendingByPerson component showing who paid the most (not who owes - that's in balances). Accept props: expenses, userId (current user to highlight). Use aggregateByPerson() to calculate total paid per person across all expenses. BarChart: horizontal bars sorted by total paid descending, current user highlighted with ios-blue color, others in gray. Show participant name + total paid. Add tooltip on hover showing expense count and average per expense. Use ResponsiveContainer for mobile. Style with iOS colors and dark mode. Show "No data" state if no expenses in range.</action>
  <verify>SpendingByPerson renders bar chart with person totals, current user highlighted, tooltip works, responsive, dark mode works</verify>
  <done>SpendingByPerson component with horizontal bars, current user highlight, tooltips</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Recharts library installed successfully
- [ ] SpendingByCategory displays pie chart with correct data
- [ ] Toggle switches between pie and bar chart
- [ ] SpendingByPerson displays bar chart with person totals
- [ ] Current user highlighted in SpendingByPerson
- [ ] Both charts responsive on mobile viewport
- [ ] Dark mode works for both charts
- [ ] "No data" states display when applicable
</verification>

<success_criteria>

- All tasks completed
- Both chart components functional
- Pie/bar toggle works smoothly
- Charts responsive and iOS-styled
- Dark mode support complete
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-export-and-categories/11-04-SUMMARY.md`
</output>
