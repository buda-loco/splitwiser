---
phase: 11-analytics-export-and-categories
plan: 02
type: execute
depends_on: ["11-01"]
files_modified: [lib/db/indexeddb.ts, lib/db/stores.ts, components/CategoryManager.tsx, app/settings/categories/page.tsx]
---

<objective>
Enable users to create, edit, reorder, and delete custom expense categories beyond the predefined set.

Purpose: Provide flexibility for users with unique expense tracking needs (e.g., "Wedding", "Side Project", "Pet Care").
Output: Custom categories table, CRUD operations, and category management UI.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-analytics-export-and-categories/11-01-SUMMARY.md
@lib/db/indexeddb.ts
@lib/db/stores.ts
@lib/types/category.ts

**Tech stack available:** IndexedDB for custom_categories store, Lucide icons, Framer Motion
**Established patterns:** Soft deletes, optimistic updates, iOS list rows
**From 11-01:** Predefined category system with PREDEFINED_CATEGORIES
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom_categories store and CRUD</name>
  <files>lib/db/indexeddb.ts, lib/db/stores.ts</files>
  <action>Add custom_categories store to IndexedDB schema (v6 migration): fields: id (uuid), user_id (uuid), name (string), icon (Lucide icon name string), color (Tailwind class), sort_order (number), created_at, is_deleted. Create CRUD functions in stores.ts: createCustomCategory(), getCustomCategories() (filter is_deleted=false, sort by sort_order), updateCustomCategory(), deleteCustomCategory() (soft delete). Add getCategoriesForPicker() helper that returns predefined + custom categories merged and sorted.</action>
  <verify>Database migration succeeds, createCustomCategory saves to IndexedDB, getCustomCategories returns sorted active categories, soft delete works</verify>
  <done>custom_categories store exists, CRUD operations functional, getCategoriesForPicker merges predefined + custom</done>
</task>

<task type="auto">
  <name>Task 2: Build CategoryManager component</name>
  <files>components/CategoryManager.tsx</files>
  <action>Create CategoryManager component with three sections: 1) Predefined categories (read-only list with "Default" badge), 2) Custom categories (editable list with edit/delete buttons), 3) "Add Custom Category" button. Custom category items show icon, name, reorder handle (drag icon). Click edit opens inline form (name input, icon picker, color picker). Delete shows confirmation dialog. Use Framer Motion Reorder.Group for drag-to-reorder (update sort_order on drop). Match iOS list styling with ListRow components and chevrons for edit navigation.</action>
  <verify>CategoryManager displays predefined + custom categories, add/edit/delete custom categories works, drag reorder updates sort_order, TypeScript compiles</verify>
  <done>CategoryManager component with add/edit/delete/reorder for custom categories, iOS-native UX</done>
</task>

<task type="auto">
  <name>Task 3: Create category management page</name>
  <files>app/settings/categories/page.tsx</files>
  <action>Create /settings/categories page that renders CategoryManager component. Add header with back button and title "Manage Categories". Add link from main settings page (/settings) to category management. Include helper text at top: "Categories help organize your expenses and power analytics". Show category count badge (X predefined + Y custom). Use standard page layout with safe areas and dark mode support.</action>
  <verify>Page loads at /settings/categories, CategoryManager renders, navigation works, helper text displays, dark mode works</verify>
  <done>Category management page accessible from settings, fully functional</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Database migration to v6 succeeds
- [ ] Creating custom category saves to IndexedDB
- [ ] getCategoriesForPicker returns predefined + custom merged
- [ ] CategoryManager displays both predefined and custom categories
- [ ] Add/edit/delete custom categories works
- [ ] Drag reorder updates sort_order
- [ ] /settings/categories page accessible
</verification>

<success_criteria>

- All tasks completed
- Custom categories fully functional
- CRUD operations work with optimistic updates
- Drag-to-reorder implemented
- iOS-native UX maintained
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-export-and-categories/11-02-SUMMARY.md`
</output>
