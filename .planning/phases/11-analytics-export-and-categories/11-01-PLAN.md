---
phase: 11-analytics-export-and-categories
plan: 01
type: execute
depends_on: []
files_modified: [lib/types/category.ts, components/CategoryPicker.tsx, lib/db/indexeddb.ts, components/ExpenseForm.tsx]
---

<objective>
Establish predefined category system with icon-based picker integration into expense creation.

Purpose: Enable expense categorization for analytics and organization, replacing the current free-text category field with a structured system.
Output: Predefined category enum, category picker component, and integrated category selection in expense flow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/ExpenseForm.tsx
@lib/db/stores.ts

**Tech stack available:** Next.js 15, TypeScript, Tailwind, Lucide icons, Framer Motion, IndexedDB
**Established patterns:** iOS-native components, Lucide icons only (NO emojis), offline-first mutations
**Current state:** Expenses have free-text category field, no structured categorization
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create predefined category system</name>
  <files>lib/types/category.ts</files>
  <action>Create category type definitions with predefined categories: Food & Dining, Transportation, Entertainment, Shopping, Bills & Utilities, Travel, Health & Medical, Groceries, Home & Rent, Other. Each category should have: id (enum), label (display name), icon (Lucide icon name as string - e.g., "UtensilsCrossed", "Car", "Film"), color (Tailwind class for category badge). Use TypeScript enums for type safety. Export CategoryType enum, Category interface, and PREDEFINED_CATEGORIES constant array.</action>
  <verify>TypeScript compiles without errors, PREDEFINED_CATEGORIES exports 10 categories with id/label/icon/color</verify>
  <done>Category type system exists with 10 predefined categories, each with Lucide icon and color</done>
</task>

<task type="auto">
  <name>Task 2: Build CategoryPicker component</name>
  <files>components/CategoryPicker.tsx</files>
  <action>Create CategoryPicker component that displays predefined categories in a grid layout (2 columns on mobile, 3-4 on tablet). Each category card shows Lucide icon (dynamically imported - use lucide-react dynamic import with React.lazy or direct icon components), label, and background color. Selected category has ios-blue border. Props: value (selected category id or null), onChange (callback with category id). Use Framer Motion for tap scale animation (whileTap scale 0.95). Match iOS-native styling with rounded cards, shadows, and proper dark mode support using semantic tokens (ios-card, ios-border). DO NOT use emojis - only Lucide icons.</action>
  <verify>CategoryPicker renders 10 category cards, clicking a category calls onChange, selected category shows blue border, icons display correctly, dark mode works</verify>
  <done>CategoryPicker component exists with grid layout, Lucide icons, selection state, and iOS-native styling</done>
</task>

<task type="auto">
  <name>Task 3: Integrate category picker into ExpenseForm</name>
  <files>components/ExpenseForm.tsx</files>
  <action>Replace the free-text category input in ExpenseForm with CategoryPicker component. Update form state to use category_id (string enum value) instead of category (free text). Store selected category ID in expense object. In Step 1 (Basic Details), add CategoryPicker below description field with label "Category (optional)". Update createExpense/updateExpense calls to save category_id. For backward compatibility: when loading existing expenses with old free-text category, map to "Other" category if no match found. Add subtle helper text: "Helps organize expenses for analytics".</action>
  <verify>ExpenseForm displays CategoryPicker, selecting category updates form state, creating expense saves category_id, TypeScript compiles</verify>
  <done>ExpenseForm uses CategoryPicker instead of text input, category_id saved to expenses, backward compatible with existing data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors
- [ ] CategoryPicker displays all 10 predefined categories with Lucide icons
- [ ] Selecting category in ExpenseForm updates state correctly
- [ ] Creating new expense saves category_id to IndexedDB
- [ ] Dark mode works for CategoryPicker
- [ ] No emojis present (only Lucide icons)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Category system established with 10 predefined categories
- CategoryPicker component functional with iOS-native UX
- ExpenseForm integrated with category selection
- No emojis used (Lucide icons only)
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-export-and-categories/11-01-SUMMARY.md`:

# Phase 11 Plan 1: Category Management Foundation Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

[Ready for parallel plans 11-02, 11-03, 11-06, or 11-07]
</output>
