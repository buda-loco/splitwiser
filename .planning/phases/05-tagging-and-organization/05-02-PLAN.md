---
phase: 05-tagging-and-organization
plan: 02
type: execute
depends_on: []
files_modified: [components/ExpenseList.tsx, app/expenses/page.tsx]
---

<objective>
Add tag-based filtering to expense list view with iOS-native filter UI.

Purpose: Enable users to quickly view expenses by tag, essential for organizing trip/group expenses.
Output: Tag filter chips in expense list, clicking filters to that tag, showing all tags used across expenses.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/04-core-expense-creation/04-07-SUMMARY.md

# Key files
@components/ExpenseList.tsx
@app/expenses/page.tsx
@lib/db/stores.ts

**Tech stack available:** Next.js 15, TypeScript, Tailwind, Framer Motion, IndexedDB
**Established patterns:** List views with filter tabs, iOS-native styling, horizontal scroll for overflow
**Constraining decisions:**
- Phase 4: ExpenseList has time-based filters (All, Last 7 days, Last 30 days)
- Phase 3: getExpenses() accepts filters.tag parameter for tag-based filtering

**Database operations available:**
- getExpenses(filters: { startDate?, tag? }) - returns expenses, filters by tag if specified
- getAllTags() - returns all unique tags across all expenses
- getExpenseTags(expense_id) - returns tags for specific expense
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tag filter UI to ExpenseList</name>
  <files>components/ExpenseList.tsx</files>
  <action>
Update ExpenseList component to add tag filtering:

1. Add state: const [selectedTag, setSelectedTag] = useState&lt;string | null&gt;(null)
2. Add state: const [availableTags, setAvailableTags] = useState&lt;string[]&gt;([])
3. Load available tags on mount: useEffect(() => { getAllTags().then(setAvailableTags) }, [])
4. Add tag filter chips ABOVE the time filter tabs:
   - Horizontal scrollable container (overflow-x-auto, flex space-x-2)
   - "All Tags" chip (selected when selectedTag === null)
   - One chip per available tag (bg-ios-blue when selected, bg-gray-200 when not)
   - Clicking chip sets selectedTag or clears if clicking current selection
   - iOS-native pill styling (rounded-full, px-4 py-2, text-sm)
5. Update expense loading to pass selectedTag to getExpenses:
   - getExpenses({ startDate: timeFilter === 'all' ? undefined : startDate, tag: selectedTag || undefined })
6. Show active filter state: "Showing [count] expenses" changes to "Showing [count] expenses tagged '[tag]'" when filtered
7. Clear button next to selected tag (X icon) - sets selectedTag to null

Dark mode: bg-gray-800 for unselected chips, border-gray-700
Framer Motion: animate chip selection with scale transition
  </action>
  <verify>ExpenseList shows tag filter chips. Clicking tag filters list to only expenses with that tag. Clicking "All Tags" shows all expenses. Tag count updates based on filter.</verify>
  <done>Tag filtering UI integrated into ExpenseList. Can filter by tag, clear filter, and see tag chips horizontally scrollable. Expense count reflects filter state.</done>
</task>

<task type="auto">
  <name>Task 2: Display tags on expense list items</name>
  <files>components/ExpenseList.tsx</files>
  <action>
Update expense list item display to show tags:

1. For each expense item, load tags: getExpenseTags(expense.id)
2. Display tags below description, above amount/date line:
   - Small tag chips (text-xs, rounded-full, px-2 py-1)
   - Max 3 tags visible, "+N more" if more than 3
   - Tag chip styling: bg-ios-blue/10, text-ios-blue, dark:bg-gray-800 dark:text-gray-300
   - Horizontal flex layout with gap-1
3. Clicking tag on expense item filters to that tag (sets selectedTag state)
4. Handle loading state for tags (don't block expense rendering)

Why show tags on list items: Users need to see organization at a glance without opening detail view.
Why limit to 3 tags: Prevents list item from becoming too tall, maintains scannable list.
  </action>
  <verify>Expense list items show tag chips below description. Clicking tag chip filters list to that tag. "+N more" indicator appears when expense has more than 3 tags.</verify>
  <done>Tags displayed on expense list items. Tag chips are clickable to filter. List remains scannable with tag limit. Dark mode styling works.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors (npx tsc --noEmit)
- [ ] Tag filter chips appear above time filters
- [ ] Clicking tag chip filters expense list
- [ ] "All Tags" chip shows all expenses
- [ ] Clear button (X) clears tag filter
- [ ] Expense count reflects active tag filter
- [ ] Tags appear on expense list items (max 3 visible)
- [ ] Clicking tag on list item filters to that tag
- [ ] Horizontal scroll works for many tags
- [ ] Dark mode styling on all tag elements
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Tag filtering works correctly on expense list
- Tags displayed on list items with click-to-filter
- iOS-native styling throughout
- Smooth animations on filter selection
</success_criteria>

<output>
After completion, create `.planning/phases/05-tagging-and-organization/05-02-SUMMARY.md`
</output>
