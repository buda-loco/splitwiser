---
phase: 05-tagging-and-organization
plan: 05
type: execute
depends_on: []
files_modified: [app/tags/[tag]/page.tsx, components/TagSummary.tsx]
---

<objective>
Create tag-based expense summary views showing expenses, balances, and participants for a specific tag context.

Purpose: Enable users to see complete picture of a trip/group (e.g., "Tokyo Trip" expenses, who owes whom in that context).
Output: Tag detail page showing all expenses, participant list, and tag-specific statistics.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/04-core-expense-creation/04-07-SUMMARY.md

# Key files
@components/ExpenseList.tsx
@lib/db/stores.ts

**Tech stack available:** Next.js 15, TypeScript, Tailwind, Framer Motion, IndexedDB
**Established patterns:** Detail pages with cards, iOS-native styling, summary statistics
**Constraining decisions:**
- Phase 4: ExpenseList already supports tag filtering via getExpenses({ tag })
- Tags are organizational, balances are global (not tag-specific) until Phase 7

**Database operations available:**
- getExpenses(filters: { tag }) - returns expenses for tag
- getExpenseParticipants(expense_id) - returns participants
- getExpenseSplits(expense_id) - returns splits
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagSummary component</name>
  <files>components/TagSummary.tsx</files>
  <action>
Create tag summary component showing tag statistics:

```typescript
export function TagSummary({ tag }: { tag: string }) {
  const [expenses, setExpenses] = useState&lt;Expense[]&gt;([])
  const [stats, setStats] = useState({
    totalExpenses: 0,
    totalAmount: 0,
    participantCount: 0,
    dateRange: { start: '', end: '' }
  })
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    async function loadTagData() {
      // 1. Load expenses for tag
      const tagExpenses = await getExpenses({ tag })
      setExpenses(tagExpenses)

      // 2. Calculate statistics
      const totalAmount = tagExpenses.reduce((sum, e) => sum + e.amount, 0)

      // 3. Find unique participants across all expenses
      const participantIds = new Set&lt;string&gt;()
      for (const expense of tagExpenses) {
        const participants = await getExpenseParticipants(expense.id)
        participants.forEach(p => {
          const id = p.user_id || p.participant_id
          if (id) participantIds.add(id)
        })
      }

      // 4. Find date range
      const dates = tagExpenses.map(e => new Date(e.expense_date)).sort()
      const start = dates[0]?.toISOString().split('T')[0] || ''
      const end = dates[dates.length - 1]?.toISOString().split('T')[0] || ''

      setStats({
        totalExpenses: tagExpenses.length,
        totalAmount,
        participantCount: participantIds.size,
        dateRange: { start, end }
      })

      setLoading(false)
    }

    loadTagData()
  }, [tag])

  if (loading) return &lt;div&gt;Loading...&lt;/div&gt;

  return (
    &lt;div className="space-y-4"&gt;
      {/* Tag header card */}
      &lt;div className="bg-white dark:bg-gray-900 rounded-2xl p-6 shadow-sm"&gt;
        &lt;h2 className="text-2xl font-bold text-black dark:text-white mb-4"&gt;
          {tag}
        &lt;/h2&gt;

        {/* Stats grid */}
        &lt;div className="grid grid-cols-2 gap-4"&gt;
          &lt;div&gt;
            &lt;p className="text-sm text-gray-500 dark:text-gray-400"&gt;Total Expenses&lt;/p&gt;
            &lt;p className="text-2xl font-semibold text-black dark:text-white"&gt;
              {stats.totalExpenses}
            &lt;/p&gt;
          &lt;/div&gt;

          &lt;div&gt;
            &lt;p className="text-sm text-gray-500 dark:text-gray-400"&gt;Total Amount&lt;/p&gt;
            &lt;p className="text-2xl font-semibold text-black dark:text-white"&gt;
              ${stats.totalAmount.toFixed(2)}
            &lt;/p&gt;
          &lt;/div&gt;

          &lt;div&gt;
            &lt;p className="text-sm text-gray-500 dark:text-gray-400"&gt;Participants&lt;/p&gt;
            &lt;p className="text-2xl font-semibold text-black dark:text-white"&gt;
              {stats.participantCount}
            &lt;/p&gt;
          &lt;/div&gt;

          &lt;div&gt;
            &lt;p className="text-sm text-gray-500 dark:text-gray-400"&gt;Date Range&lt;/p&gt;
            &lt;p className="text-sm font-medium text-black dark:text-white"&gt;
              {stats.dateRange.start} - {stats.dateRange.end}
            &lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {/* Note about balances */}
      &lt;div className="bg-ios-blue/10 dark:bg-gray-800 rounded-xl p-4"&gt;
        &lt;p className="text-sm text-ios-blue dark:text-gray-300"&gt;
          üí° Tag-specific balance calculation coming in Phase 7. For now, balances are global across all expenses.
        &lt;/p&gt;
      &lt;/div&gt;

      {/* Expense list for this tag */}
      &lt;div&gt;
        &lt;h3 className="text-lg font-semibold text-black dark:text-white mb-3"&gt;
          Expenses
        &lt;/h3&gt;
        {/* Reuse ExpenseList but filter to this tag */}
      &lt;/div&gt;
    &lt;/div&gt;
  )
}
```

iOS-native styling: Cards with rounded-2xl, shadows, proper spacing
Dark mode: All colors support dark variants
Loading state: Simple loading message (skeleton loader in future)
  </action>
  <verify>TagSummary renders with correct statistics. Shows total expenses, amount, participant count, date range. Displays note about future balance feature.</verify>
  <done>TagSummary component exists with tag statistics and iOS-native card layout.</done>
</task>

<task type="auto">
  <name>Task 2: Create tag detail page</name>
  <files>app/tags/[tag]/page.tsx</files>
  <action>
Create dynamic route for tag detail:

```typescript
export default async function TagDetailPage({
  params
}: {
  params: Promise&lt;{ tag: string }&gt;
}) {
  const { tag } = await params
  const decodedTag = decodeURIComponent(tag)

  return (
    &lt;main className="min-h-screen bg-gray-50 dark:bg-black pb-safe"&gt;
      {/* Header with back button */}
      &lt;div className="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 py-3 flex items-center gap-3"&gt;
        &lt;button
          onClick={() => router.back()}
          className="text-ios-blue dark:text-ios-blue text-base"
        &gt;
          ‚Üê Back
        &lt;/button&gt;
        &lt;h1 className="text-xl font-semibold text-black dark:text-white"&gt;
          Tag Details
        &lt;/h1&gt;
      &lt;/div&gt;

      {/* Tag summary component */}
      &lt;div className="p-4"&gt;
        &lt;TagSummary tag={decodedTag} /&gt;
      &lt;/div&gt;
    &lt;/main&gt;
  )
}
```

Navigation: Clicking tag chip in ExpenseList should navigate to /tags/[tag]
URL encoding: Tags with spaces/special chars need encoding (automatic with Next.js Link)
  </action>
  <verify>Navigate to /tags/tokyo-trip shows tag detail page. Back button works. TagSummary displays with correct statistics.</verify>
  <done>Tag detail page created at /tags/[tag] with header and TagSummary component.</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation to tag detail from ExpenseList</name>
  <files>components/ExpenseList.tsx</files>
  <action>
Update ExpenseList tag chips to navigate to tag detail:

In the tag filter chips at top:
- Wrap each tag chip in Link component: &lt;Link href={`/tags/${encodeURIComponent(tag)}`}&gt;
- Keep onClick for filtering (use onClick with router.push instead of Link if needed)

In the expense list item tags:
- Wrap tag chips in Link: &lt;Link href={`/tags/${encodeURIComponent(tag)}`}&gt;
- Add hover effect: hover:bg-ios-blue/20 transition-colors

Why navigate to detail: Users want to see complete tag context (all expenses, statistics) beyond just filtering.
Why keep filter option: Quick filtering without full page navigation is still useful. Consider: Filter on click, detail on long-press (future).
For now: Click navigates to detail page (simpler UX).
  </action>
  <verify>Clicking tag chip in filter bar navigates to tag detail page. Clicking tag on expense list item navigates to tag detail page. URL encoding works for tags with spaces.</verify>
  <done>ExpenseList tag chips navigate to tag detail page. Hover effects indicate clickability. URL encoding handles special characters.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors (npx tsc --noEmit)
- [ ] TagSummary component shows correct statistics
- [ ] Tag detail page renders at /tags/[tag]
- [ ] Statistics calculate correctly (total expenses, amount, participants, date range)
- [ ] Back button works from tag detail
- [ ] Clicking tag chip navigates to tag detail
- [ ] URL encoding works for tags with spaces/special chars
- [ ] Dark mode styling on all components
- [ ] iOS-native card layouts and typography
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Tag detail page shows comprehensive tag statistics
- Navigation from expense list to tag detail works
- iOS-native styling throughout
- Statistics accurately reflect tag context
</success_criteria>

<output>
After completion, create `.planning/phases/05-tagging-and-organization/05-05-SUMMARY.md`

# Phase 5 Complete

After this plan, Phase 5 (Tagging & Organization) is complete.
Ready for Phase 6: Balance Calculation Engine.
</output>
