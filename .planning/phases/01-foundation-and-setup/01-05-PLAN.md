---
phase: 01-foundation-and-setup
plan: 05
type: execute
depends_on: [01-04]
files_modified: [components/BottomNav.tsx, app/layout.tsx, app/page.tsx, app/balances/page.tsx, app/settings/page.tsx]
---

<objective>
Verify and refine safe area padding across all layouts for notched iOS devices.

Purpose: Ensure app layout respects device safe areas (notch, home indicator, status bar) for native feel on all iOS devices.
Output: All layouts correctly use safe area utilities with visual verification on notched devices.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-setup/01-01-SUMMARY.md
@.planning/phases/01-foundation-and-setup/01-04-SUMMARY.md

**Tech Stack:**
- Tailwind safe area utilities (configured in Plan 01-01)
- iOS viewport with viewportFit: "cover" (configured in Plan 01-01)
- Bottom navigation and page layouts (created in Plan 01-04)

**Key Requirements:**
- Content must not appear under notch or home indicator
- Bottom nav must sit above home indicator (pb-safe-bottom)
- Page content must respect top safe area (pt-safe-top)
- Works on iPhone X and newer (notched devices)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix safe area usage in BottomNav</name>
  <files>components/BottomNav.tsx</files>
  <action>
Review components/BottomNav.tsx and ensure safe area padding is correctly applied:

Current code should have:
```typescript
<nav className="fixed bottom-0 left-0 right-0 pb-safe-bottom bg-white/80 backdrop-blur-lg border-t border-gray-200">
```

Verify:
- `pb-safe-bottom` is present (adds padding for home indicator)
- No conflicting padding that would override safe area
- Dark mode variant includes safe area:

Add dark mode support if not present:
```typescript
<nav className="fixed bottom-0 left-0 right-0 pb-safe-bottom bg-white/80 dark:bg-black/80 backdrop-blur-lg border-t border-gray-200 dark:border-gray-800">
```

This ensures bottom nav:
- Sits above home indicator on notched devices
- Maintains proper spacing on older devices (no negative effect)
- Works in both light and dark mode
  </action>
  <verify>Inspect components/BottomNav.tsx, confirm pb-safe-bottom class present, dark mode variant added</verify>
  <done>Bottom navigation correctly uses safe area padding with dark mode support</done>
</task>

<task type="auto">
  <name>Task 2: Audit and fix safe area usage in page layouts</name>
  <files>app/page.tsx, app/balances/page.tsx, app/settings/page.tsx</files>
  <action>
Review all page files and ensure consistent safe area padding:

Each page should have:
```typescript
<main className="min-h-screen pt-safe-top pb-safe-bottom px-4">
```

Verify all three pages (/, /balances, /settings) have:
- `pt-safe-top` - respects status bar and notch
- `pb-safe-bottom` - respects home indicator
- Both present on the main container

If any page is missing these classes, add them.

Example correct structure:
```typescript
export default function SomePage() {
  return (
    <PageTransition>
      <main className="min-h-screen pt-safe-top pb-safe-bottom px-4">
        <div className="max-w-md mx-auto pt-16">
          {/* Content */}
        </div>
      </main>
    </PageTransition>
  )
}
```

Key points:
- Safe area padding on main element (outermost in PageTransition)
- Content wrapper (max-w-md) is inside, doesn't override safe area
- Additional pt-16 for visual spacing (separate from safe area)
  </action>
  <verify>Grep all page files for pt-safe-top and pb-safe-bottom, confirm present in all three pages</verify>
  <done>All pages consistently use safe area padding for top and bottom</done>
</task>

<task type="auto">
  <name>Task 3: Verify root layout safe area configuration</name>
  <files>app/layout.tsx</files>
  <action>
Review app/layout.tsx and confirm viewport configuration for safe areas:

Verify viewport export includes:
```typescript
export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
  viewportFit: "cover", // CRITICAL for safe areas
};
```

The `viewportFit: "cover"` is essential - it tells iOS to extend the viewport into safe areas so we can control padding with CSS.

Without it, iOS will shrink the viewport and safe area utilities won't work.

If viewportFit is missing, add it.

Also verify body does NOT have conflicting padding:
```typescript
<body className="antialiased pb-16">
```

The pb-16 here is for bottom nav height (not safe area). This is correct because bottom nav itself has pb-safe-bottom.

Document in comment:
```typescript
<body className="antialiased pb-16"> {/* pb-16 for bottom nav height, nav handles safe area */}
```
  </action>
  <verify>app/layout.tsx viewport export includes viewportFit: "cover", body has pb-16 with explanatory comment</verify>
  <done>Root layout viewport configured correctly for safe area support</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Safe area padding throughout app for iOS notched devices</what-built>
  <how-to-verify>
**Desktop verification (limited - safe areas are 0px on desktop):**
1. Visit http://localhost:3000
2. Open DevTools > Elements
3. Inspect `<nav>` element with class pb-safe-bottom
4. Check Computed styles - should show padding-bottom (will be 0px on desktop)
5. Inspect `<main>` element on any page
6. Check Computed styles - should show padding-top and padding-bottom (will be 0px on desktop)

**iOS Safari verification (REQUIRED for full test):**
1. Find local IP: `ipconfig getifaddr en0` (Mac) or `hostname -I` (Linux)
2. On iPhone X or newer, visit http://[your-ip]:3000
3. Verify top safe area:
   - Status bar should be visible (not covered by content)
   - "Expenses" heading should start below notch
   - No content under notch
4. Verify bottom safe area:
   - Bottom nav should sit above home indicator
   - No content under home indicator
   - Tap targets should be above home indicator
5. Test all three tabs (Expenses, Balances, Settings)
6. Verify consistent safe area treatment on all pages
7. Enable Dark Mode (swipe down from top-right > long press brightness)
8. Verify safe areas work in dark mode

**Expected outcomes:**
- Desktop: Safe area classes present (padding values will be 0)
- iOS: Content respects notch (top) and home indicator (bottom)
- iOS: Bottom nav sits properly above home indicator
- iOS: All pages have consistent safe area spacing
- Dark mode: Safe areas work correctly

**If you don't have an iPhone with notch:**
- Chrome DevTools Device Mode doesn't fully simulate safe areas
- Mark as approved if desktop verification passes
- Document that production testing on real device is needed
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `components/BottomNav.tsx` has pb-safe-bottom class
- [ ] All pages (/, /balances, /settings) have pt-safe-top and pb-safe-bottom
- [ ] `app/layout.tsx` viewport includes viewportFit: "cover"
- [ ] Dark mode classes added to BottomNav
- [ ] Human verification confirms safe areas working (or desktop check passed)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Bottom navigation uses safe area padding (pb-safe-bottom)
- All pages use safe area padding (pt-safe-top, pb-safe-bottom)
- Root layout viewport configured with viewportFit: "cover"
- Dark mode support for safe area elements
- Human verification confirms layout on iOS device (or desktop verification passed)
- Phase 1 complete - foundation ready for Phase 2 authentication
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-setup/01-05-SUMMARY.md`:

---
phase: 01-foundation-and-setup
plan: 05
completed: [YYYY-MM-DD]
subsystem: ui-foundation
requires: [01-04]
provides: [safe-area-implementation, ios-device-support]
affects: []
tags: [setup, ios, safe-areas, layout]
key-decisions:
  - "viewportFit: cover enables CSS safe area control"
  - "Safe area padding on outermost elements (main, nav)"
  - "Dark mode support for all safe area elements"
key-files:
  - components/BottomNav.tsx
  - app/layout.tsx
  - app/page.tsx
  - app/balances/page.tsx
  - app/settings/page.tsx
tech-stack:
  added: []
  patterns: [safe-area-padding, viewport-fit-cover, dark-mode-safe-areas]
---

# Phase 1 Plan 5: Safe Area Implementation

**Safe area padding verified and refined across all layouts for iOS notched devices.**

## Accomplishments

- Audited and confirmed safe area padding in bottom navigation (pb-safe-bottom)
- Verified safe area padding across all pages (pt-safe-top, pb-safe-bottom)
- Confirmed viewport configuration with viewportFit: "cover"
- Added dark mode support to bottom navigation
- Human verification on iOS device (or desktop check passed)
- Phase 1 foundation complete

## Files Created/Modified

- `components/BottomNav.tsx` - Confirmed pb-safe-bottom, added dark mode variant
- `app/layout.tsx` - Verified viewportFit: "cover" in viewport config
- `app/page.tsx` - Confirmed safe area padding
- `app/balances/page.tsx` - Confirmed safe area padding
- `app/settings/page.tsx` - Confirmed safe area padding

## Decisions Made

**viewportFit: "cover" is critical**: Without this viewport meta setting, iOS will shrink the viewport to avoid safe areas, making CSS env() variables unavailable. "cover" extends viewport into safe areas so we control padding with Tailwind utilities.

**Safe area padding on outermost elements**: Applied pt-safe-top and pb-safe-bottom on the outermost container of each page (main element). Inner content wrappers don't override these values.

**Dark mode safe area support**: Bottom navigation includes dark mode variant (dark:bg-black/80, dark:border-gray-800) to ensure safe area padding works in both light and dark themes.

## Issues Encountered

[Document if human verification couldn't be performed on real iOS device - note that production testing is recommended]

## Next Phase Readiness

**Phase 1 Complete - Foundation ready:**
- ✅ Next.js 15 with TypeScript and App Router
- ✅ Tailwind CSS with iOS design tokens
- ✅ Supabase client (SSR-safe utilities)
- ✅ PWA manifest and service worker
- ✅ Framer Motion with page transitions
- ✅ Bottom tab navigation
- ✅ Safe area padding for iOS devices

**Ready for Phase 2: Authentication & User Model**
- Supabase client utilities ready for auth flows
- Layout structure ready for auth UI
- Navigation shell ready for protected routes

## Next Step

Phase 1 complete. Run `/gsd:progress` to see overall status, or `/gsd:plan-phase 2` to plan Phase 2 (Authentication & User Model).
</output>
