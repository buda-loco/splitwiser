---
phase: 01-foundation-and-setup
plan: 04
type: execute
depends_on: [01-01]
files_modified: [package.json, app/layout.tsx, components/PageTransition.tsx, components/BottomNav.tsx]
---

<objective>
Setup Framer Motion and create base layout structure with iOS-native navigation patterns.

Purpose: Establish animation foundation and create reusable layout components for iOS-native feel.
Output: Framer Motion configured with page transition wrapper, bottom navigation component, and iOS-style layout shell.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-setup/01-01-SUMMARY.md

**Tech Stack:**
- Framer Motion for animations and gestures
- Next.js App Router (requires "use client" for Framer Motion)
- iOS-native patterns (bottom tabs, smooth transitions)

**Key Requirements:**
- Client Component pattern for animations (App Router limitation)
- Page transition wrapper using Template component pattern
- Bottom tab navigation foundation (content filled in later phases)
- Smooth, gesture-driven feel matching iOS native apps
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Framer Motion</name>
  <files>package.json</files>
  <action>
Install Framer Motion:
```bash
npm install framer-motion
```

Verify installation:
- Check package.json contains framer-motion (not the newer "motion" package - framer-motion is still standard for React)
- Should be in dependencies (not devDependencies)

Note: We're using framer-motion (not motion package). The motion package is newer but framer-motion is still recommended for React projects as of 2026.
  </action>
  <verify>npm list framer-motion shows installed version</verify>
  <done>Framer Motion installed in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create page transition wrapper component</name>
  <files>components/PageTransition.tsx</files>
  <action>
Create components/PageTransition.tsx as Client Component:

```typescript
'use client'

import { motion, AnimatePresence } from 'framer-motion'
import { ReactNode } from 'react'

interface PageTransitionProps {
  children: ReactNode
}

export function PageTransition({ children }: PageTransitionProps) {
  return (
    <AnimatePresence mode="wait">
      <motion.div
        initial={{ opacity: 0, x: 20 }}
        animate={{ opacity: 1, x: 0 }}
        exit={{ opacity: 0, x: -20 }}
        transition={{
          type: 'spring',
          stiffness: 260,
          damping: 20,
        }}
      >
        {children}
      </motion.div>
    </AnimatePresence>
  )
}
```

This provides:
- Smooth slide-in from right (iOS native pattern)
- Slide-out to left on exit
- Spring physics for natural feel (not linear easing)
- AnimatePresence for exit animations

Pattern for usage in page components:
```typescript
import { PageTransition } from '@/components/PageTransition'

export default function MyPage() {
  return (
    <PageTransition>
      <div>Page content here</div>
    </PageTransition>
  )
}
```

Note: We're NOT using Template component pattern yet (has issues with App Router AnimatePresence). This wrapper is manually applied per page for now. Phase 10 will refine page transitions.
  </action>
  <verify>File exists at components/PageTransition.tsx, contains "use client" directive, imports from framer-motion</verify>
  <done>Page transition wrapper created as reusable Client Component</done>
</task>

<task type="auto">
  <name>Task 3: Create bottom navigation component</name>
  <files>components/BottomNav.tsx</files>
  <action>
Create components/BottomNav.tsx with iOS bottom tab pattern:

```typescript
'use client'

import { motion } from 'framer-motion'
import { usePathname } from 'next/navigation'
import Link from 'next/link'

const tabs = [
  { id: 'expenses', label: 'Expenses', path: '/', icon: 'üí∏' },
  { id: 'balances', label: 'Balances', path: '/balances', icon: 'üí∞' },
  { id: 'settings', label: 'Settings', path: '/settings', icon: '‚öôÔ∏è' },
]

export function BottomNav() {
  const pathname = usePathname()

  return (
    <nav className="fixed bottom-0 left-0 right-0 pb-safe-bottom bg-white/80 backdrop-blur-lg border-t border-gray-200">
      <div className="flex justify-around items-center h-16 max-w-md mx-auto px-4">
        {tabs.map((tab) => {
          const isActive = pathname === tab.path
          return (
            <Link
              key={tab.id}
              href={tab.path}
              className="flex flex-col items-center justify-center flex-1 relative"
            >
              <motion.div
                className="flex flex-col items-center"
                whileTap={{ scale: 0.9 }}
                transition={{ type: 'spring', stiffness: 400, damping: 17 }}
              >
                <span className="text-2xl mb-1">{tab.icon}</span>
                <span
                  className={`text-xs ${
                    isActive ? 'text-ios-blue font-semibold' : 'text-ios-gray'
                  }`}
                >
                  {tab.label}
                </span>
              </motion.div>
              {isActive && (
                <motion.div
                  layoutId="activeTab"
                  className="absolute -top-0.5 left-1/2 -translate-x-1/2 w-12 h-0.5 bg-ios-blue rounded-full"
                  transition={{ type: 'spring', stiffness: 380, damping: 30 }}
                />
              )}
            </Link>
          )
        })}
      </div>
    </nav>
  )
}
```

This provides:
- Fixed bottom positioning with safe area support (pb-safe-bottom)
- Frosted glass backdrop (iOS 15+ style)
- Active tab indicator with smooth animation (layoutId shared)
- Tap feedback (whileTap scale)
- Emoji icons (placeholder - Phase 10 will add proper icon library)
- Three tabs: Expenses (home), Balances, Settings

iOS-native details:
- Frosted glass background (bg-white/80 backdrop-blur-lg)
- Active state in iOS blue
- Smooth animated indicator
- Tap feedback on press
- Safe area padding for home indicator
  </action>
  <verify>File exists at components/BottomNav.tsx, contains "use client" directive, uses usePathname and motion components</verify>
  <done>Bottom navigation component created with iOS tab bar pattern</done>
</task>

<task type="auto">
  <name>Task 4: Integrate bottom nav into root layout</name>
  <files>app/layout.tsx</files>
  <action>
Update app/layout.tsx to include BottomNav:

```typescript
import type { Metadata, Viewport } from "next";
import Script from "next/script";
import { BottomNav } from "@/components/BottomNav";
import "./globals.css";

export const metadata: Metadata = {
  title: "Splitwiser",
  description: "Beautiful expense splitting for iOS",
  manifest: "/manifest.json",
  appleWebApp: {
    capable: true,
    statusBarStyle: "default",
    title: "Splitwiser",
  },
};

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
  viewportFit: "cover",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className="antialiased pb-16">
        {/* Content area with bottom padding for fixed nav */}
        <div className="min-h-screen">
          {children}
        </div>

        {/* Bottom navigation */}
        <BottomNav />

        {/* Service worker registration */}
        <Script id="register-sw" strategy="afterInteractive">
          {`
            if ('serviceWorker' in navigator) {
              window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                  (registration) => {
                    console.log('SW registered:', registration);
                  },
                  (error) => {
                    console.log('SW registration failed:', error);
                  }
                );
              });
            }
          `}
        </Script>
      </body>
    </html>
  );
}
```

Key changes:
- Import BottomNav component
- Wrap children in div with min-h-screen (full height content)
- Add pb-16 to body (padding for fixed bottom nav)
- Render BottomNav after children (fixed to bottom)

This creates the shell for all pages to have consistent bottom navigation.
  </action>
  <verify>Visit localhost:3000, see bottom navigation with 3 tabs at bottom of screen, clicking tabs changes active indicator</verify>
  <done>Bottom navigation integrated into root layout, visible on all pages</done>
</task>

<task type="auto">
  <name>Task 5: Create placeholder pages for bottom nav tabs</name>
  <files>app/balances/page.tsx, app/settings/page.tsx</files>
  <action>
Create app/balances/page.tsx:

```typescript
import { PageTransition } from '@/components/PageTransition'

export default function BalancesPage() {
  return (
    <PageTransition>
      <main className="min-h-screen pt-safe-top pb-safe-bottom px-4">
        <div className="max-w-md mx-auto pt-16">
          <h1 className="text-3xl font-bold text-ios-blue mb-4">
            Balances
          </h1>
          <p className="text-ios-gray">
            Balance calculations coming in Phase 6
          </p>
        </div>
      </main>
    </PageTransition>
  )
}
```

Create app/settings/page.tsx:

```typescript
import { PageTransition } from '@/components/PageTransition'

export default function SettingsPage() {
  return (
    <PageTransition>
      <main className="min-h-screen pt-safe-top pb-safe-bottom px-4">
        <div className="max-w-md mx-auto pt-16">
          <h1 className="text-3xl font-bold text-ios-blue mb-4">
            Settings
          </h1>
          <p className="text-ios-gray">
            Settings coming in later phases
          </p>
        </div>
      </main>
    </PageTransition>
  )
}
```

Update app/page.tsx to use PageTransition wrapper:

```typescript
import { PageTransition } from '@/components/PageTransition'

export default function Home() {
  return (
    <PageTransition>
      <main className="min-h-screen pt-safe-top pb-safe-bottom px-4">
        <div className="max-w-md mx-auto pt-16">
          <h1 className="text-3xl font-bold text-ios-blue mb-4">
            Expenses
          </h1>
          <p className="text-ios-gray">
            Expense management coming in Phase 4
          </p>
        </div>
      </main>
    </PageTransition>
  )
}
```

These placeholder pages:
- Demonstrate bottom nav tab switching
- Show PageTransition animations in action
- Use safe area padding
- Maintain consistent layout across pages
- Will be replaced with real content in later phases
  </action>
  <verify>Navigate between tabs at localhost:3000, see smooth page transitions, active tab indicator moves, each page shows correct heading</verify>
  <done>Placeholder pages created for all bottom nav tabs with transition animations</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm list framer-motion` shows package installed
- [ ] `components/PageTransition.tsx` exports PageTransition component
- [ ] `components/BottomNav.tsx` exports BottomNav component
- [ ] Bottom nav visible at bottom of all pages
- [ ] Clicking tabs changes active indicator with smooth animation
- [ ] Page transitions animate on tab switch (slide in/out)
- [ ] All three pages render correctly (/, /balances, /settings)
- [ ] No Framer Motion errors in console
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Framer Motion installed and configured
- Page transition wrapper created as reusable component
- Bottom navigation component implements iOS tab bar pattern
- Root layout integrates bottom nav on all pages
- Placeholder pages demonstrate navigation and transitions
- Foundation ready for Phase 10 iOS UX polish (gestures, refined transitions)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-setup/01-04-SUMMARY.md`:

---
phase: 01-foundation-and-setup
plan: 04
completed: [YYYY-MM-DD]
subsystem: ui-foundation
requires: [01-01]
provides: [framer-motion, page-transitions, bottom-navigation, layout-shell]
affects: [04-06, 10-01, 10-02, 10-03, 10-04, 10-09]
tags: [setup, framer-motion, animations, ios-ux]
key-decisions:
  - "Framer Motion for animations (standard React choice)"
  - "Manual PageTransition wrapper (not Template pattern)"
  - "Bottom tab navigation with frosted glass"
key-files:
  - components/PageTransition.tsx
  - components/BottomNav.tsx
  - app/layout.tsx
tech-stack:
  added: [framer-motion]
  patterns: [client-components, page-transitions, bottom-tabs, frosted-glass]
---

# Phase 1 Plan 4: Framer Motion & Base Layout

**Framer Motion configured with page transitions and iOS-native bottom tab navigation.**

## Accomplishments

- Installed Framer Motion for animations and gestures
- Created reusable PageTransition wrapper component
- Built bottom tab navigation with iOS frosted glass style
- Integrated bottom nav into root layout (visible on all pages)
- Created placeholder pages demonstrating navigation and transitions
- Established layout shell for iOS-native feel

## Files Created/Modified

- `package.json` - Added framer-motion dependency
- `components/PageTransition.tsx` - Slide transition wrapper with spring physics
- `components/BottomNav.tsx` - iOS bottom tab bar with animated indicator
- `app/layout.tsx` - Integrated bottom nav and content padding
- `app/page.tsx` - Updated with PageTransition wrapper
- `app/balances/page.tsx` - Placeholder Balances page
- `app/settings/page.tsx` - Placeholder Settings page

## Decisions Made

**Framer Motion over alternatives**: Standard choice for React animations. Works well with App Router when used in Client Components. Provides declarative API and spring physics.

**Manual PageTransition wrapper**: App Router's Template component has known issues with AnimatePresence (exit animations don't fire reliably). Manual wrapper applied per page gives better control. Phase 10 will refine this pattern.

**Bottom tab navigation**: iOS standard pattern for primary app navigation. Frosted glass backdrop (bg-white/80 backdrop-blur-lg) matches iOS 15+ native feel. Active indicator uses layoutId for smooth animation.

## Issues Encountered

None - Framer Motion setup worked as expected with "use client" directives.

## Next Phase Readiness

**Animation foundation established:**
- PageTransition wrapper ready for all pages
- Bottom nav demonstrates animated indicator (layoutId pattern)
- Spring physics configured for natural feel
- Client Component pattern established for all interactive UI

**Phase 10 will add:**
- Swipe-back gestures
- Sheet modal animations
- Drag-to-dismiss
- Refined page transitions
- Micro-interactions

**Ready for content:**
- Phase 4: Expense creation pages
- Phase 6: Balance display pages
- Phase 7: Settlement flows
- All will use PageTransition wrapper and bottom nav shell

## Next Step

Plan 01-05 (Safe area padding) depends on this plan's layout structure. Ready for sequential execution or completion of Phase 1.
</output>
