---
phase: 08-templates-and-efficiency-features
plan: 02
type: execute
depends_on: ["08-01"]
files_modified: [components/TemplateForm.tsx, app/templates/new/page.tsx]
---

<objective>
Build template creation form UI with participant selection and split configuration.

Purpose: Allow users to create named templates with participants and split values for quick reuse across expenses.
Output: Template creation form component and new template page, ready for users to save split configurations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-templates-and-efficiency-features/08-01-SUMMARY.md
@lib/db/types.ts
@lib/db/stores.ts
@components/ExpenseForm.tsx
@components/ParticipantPicker.tsx
@components/SplitEqual.tsx
@components/SplitByPercentage.tsx
@components/SplitByShares.tsx

**Tech stack available:** Next.js 15, React, TypeScript, Tailwind, Framer Motion
**Established patterns:**
- iOS-native styling with design tokens (ios-blue, ios-gray, ios-red)
- Multi-step forms with step navigation
- ParticipantPicker component for selecting users/participants
- Split method components (SplitEqual, SplitByPercentage, SplitByShares)
- Form validation with touched state tracking
- Optimistic updates via useOptimisticMutation hook

**From 08-01:**
- Template types: SplitTemplate, TemplateCreateInput
- CRUD operations: createTemplate, getTemplatesByUser
- Template stores participants with split_value per participant
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TemplateForm component</name>
  <files>components/TemplateForm.tsx</files>
  <action>
Create TemplateForm component following ExpenseForm patterns but simplified for template creation:

**Form fields:**
1. Template name input (text, required, 1-100 chars)
2. Split type selector (radio buttons: equal, percentage, shares, exact)
3. Participant picker (reuse ParticipantPicker component)
4. Split configuration based on type:
   - Equal: No additional input needed (display "Split equally among N participants")
   - Percentage: Use SplitByPercentage component
   - Shares: Use SplitByShares component
   - Exact: Similar to percentage but label as "Fixed amounts"

**Component structure:**
- 2-step flow: Basic (name + split type) â†’ Participants & Splits
- Reuse ParticipantPicker for participant selection
- Conditionally render split method component based on split_type
- Validation: name required, at least 2 participants, splits must total 100% (percentage) or be valid (shares/exact)
- Props: onSubmit(template: TemplateCreateInput), onCancel
- iOS-native styling matching ExpenseForm

**Type:**
```typescript
export type TemplateFormData = {
  name: string;
  split_type: 'equal' | 'percentage' | 'shares' | 'exact';
  participants: ParticipantWithDetails[];
  splits: Array<{
    user_id?: string | null;
    participant_id?: string | null;
    split_value?: number | null;
  }>;
};
```

Use ExpenseForm as reference but remove amount, currency, description, category, date, tags fields. Focus only on template-specific fields.

Avoid duplicating split method logic - reuse SplitByPercentage, SplitByShares components by passing participants and onSplitsChange callback.
  </action>
  <verify>TypeScript compiles without errors, component exports TemplateFormData type</verify>
  <done>TemplateForm component created with 2-step flow, participant picker integration, split method reuse, iOS-native styling</done>
</task>

<task type="auto">
  <name>Task 2: Create new template page with form integration</name>
  <files>app/templates/new/page.tsx</files>
  <action>
Create new template page following app/expenses/new/page.tsx pattern:

**Page structure:**
```typescript
'use client';

import { useRouter } from 'next/navigation';
import { TemplateForm } from '@/components/TemplateForm';
import { createTemplate } from '@/lib/db/stores';
import type { TemplateCreateInput } from '@/lib/db/types';

export default function NewTemplatePage() {
  const router = useRouter();

  async function handleSubmit(formData: TemplateFormData) {
    // TODO: Get current user ID from auth context
    const userId = 'temp-user-id';

    const input: TemplateCreateInput = {
      name: formData.name,
      split_type: formData.split_type,
      created_by_user_id: userId,
      participants: formData.participants.map(p => ({
        user_id: p.type === 'user' ? p.id : null,
        participant_id: p.type === 'participant' ? p.id : null,
        split_value: formData.split_type === 'equal' ? null : (p.split_value || null)
      }))
    };

    await createTemplate(input);

    // Navigate to templates list page after creation
    router.push('/templates');
  }

  return (
    <div className="min-h-screen bg-ios-gray6 dark:bg-black pb-safe">
      <div className="max-w-2xl mx-auto px-4 pt-safe">
        <TemplateForm
          onSubmit={handleSubmit}
          onCancel={() => router.back()}
        />
      </div>
    </div>
  );
}
```

**Key points:**
- Use createTemplate directly (no optimistic updates needed for templates - they're local only until sync)
- Navigate to /templates list after creation
- Add TODO comment for auth integration (same as ExpenseForm)
- Match page styling from app/expenses/new/page.tsx

No optimistic updates hook needed - templates are created locally and synced in background, no need for instant UI feedback like expenses.
  </action>
  <verify>TypeScript compiles without errors, page renders without runtime errors</verify>
  <done>New template page created with form integration, navigation to /templates after creation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors (`npx tsc --noEmit`)
- [ ] TemplateForm component follows ExpenseForm patterns (iOS styling, validation, multi-step)
- [ ] Split method components are reused (not duplicated)
- [ ] New template page integrates with createTemplate function
- [ ] Form validation prevents invalid submissions
</verification>

<success_criteria>

- TemplateForm component created with 2-step flow
- Participant picker and split method components reused
- Form validation ensures name, participants, and valid splits
- New template page created at app/templates/new/page.tsx
- Navigation to /templates after successful creation
- All verification checks pass
- No TypeScript errors introduced
  </success_criteria>

<output>
After completion, create `.planning/phases/08-templates-and-efficiency-features/08-02-SUMMARY.md`:

# Phase 8 Plan 2: Template Creation Form Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `file.tsx` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 08-04-PLAN.md (template management UI)
</output>
